<%page args="runewords, gemapplytype_names, runes"/>\

<form id="ingredientsForm">
% for rune in runes:
    <label><input type="checkbox" value="${rune[1]}" class="ingredient">${rune[0]}</label>
% endfor
</form>


<script>
    // Function to strip HTML tags
    function removeHtmlTags(str) {
        const doc = new DOMParser().parseFromString(str, 'text/html');
        return doc.body.textContent || "";
    }

    // Ensure the DOM is fully loaded before running any JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        // Get all the checkboxes and recipe rows after the DOM is ready
        const ingredientCheckboxes = document.querySelectorAll('.ingredient');
        const recipeRows = document.querySelectorAll('.recipeRow');

        // Function to check the ingredients
        function checkIngredients() {
            // Get selected ingredients
            const selectedIngredients = [];
            ingredientCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedIngredients.push(checkbox.value);
                }
            });

            // Loop through all the rows and check if all ingredients match
            recipeRows.forEach(row => {
                const fontTag = row.querySelector('.ingredients font');
                if (!fontTag) {
                    row.style.display = 'none'; // If no ingredients are found, hide the row
                    return;
                }

                const rawIngredients = fontTag.innerHTML.split('<br>') // Split by <br>
                    .map(ingredient => ingredient.trim()) // Remove extra whitespace
                    .filter(ingredient => ingredient !== ''); // Remove empty strings

                // Strip HTML tags from each ingredient
                const rowIngredients = rawIngredients.map(removeHtmlTags);

                // If no ingredients are in the row, hide it
                if (rowIngredients.length === 0) {
                    row.style.display = 'none'; // Hide rows with no ingredients
                    return;
                }

                // Check if any of the row's ingredients match selected ingredients
                const isMatch = rowIngredients.every(ingredient => selectedIngredients.includes(ingredient));

                // Show or hide the row based on whether all ingredients match
                if (selectedIngredients.length === 0 || isMatch) {
                    row.style.display = ''; // Show the row if no ingredients are selected or if it matches
                } else {
                    row.style.display = 'none'; // Hide the row if it doesn't match
                }
            });
        }

        // Event listener to trigger the check when a checkbox is clicked
        ingredientCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', checkIngredients);
        });

        // Call the function to initialize the visibility of rows
        checkIngredients();
    });
</script>













<table cellpadding="5" border="0">
<thead>
<tr>
<th width="125" bgcolor="#402040" align="center"><font size="-1" face="arial,helvetica">
Rune Word</font></th>
<th width="125" bgcolor="#402040" align="center"><font size="-1" face="arial,helvetica">
Runes</font></th>
<th width="205" bgcolor="#402040" align="center"><font size="-1" face="arial,helvetica">
Allowed Items</font></th>
<th width="375" bgcolor="#402040" align="center"><font size="-1" face="arial,helvetica">
${gemapplytype_names[0]}</font></th>
<th width="375" bgcolor="#402040" align="center"><font size="-1" face="arial,helvetica">
${gemapplytype_names[1]}</font></th>
<th width="375" bgcolor="#402040" align="center"><font size="-1" face="arial,helvetica">
${gemapplytype_names[2]}</font></th>
</tr>

</thead>
<tbody>

% for runeword in runewords:
<tr class="recipeRow">
<td bgcolor="#101010" align="center"><font size="-1" face="arial,helvetica"><font color="#908858"><b>${runeword.name}</b></font><br><br>(${runeword.num_sockets} Socket)<br><br></font></td>
<td class="ingredients bgcolor="#101010" align="center"><font size="-1" face="arial,helvetica" color="#908858">${runeword.rune_string()}</font></td>
<td bgcolor="#101010" align="center"><font size="-1" face="arial,helvetica">${runeword.bases_string()}</font></td>

<td bgcolor="#101010" align="center"><font size="-1" face="arial,helvetica"><font color="8080E6">
% if runeword.gemapplytype[0] == True:
${runeword.stats_string()}<br>${runeword.rune_stats_string(0)}
<!--${runeword.types[0]}-->
% endif
</font></font></td>

<td bgcolor="#101010" align="center"><font size="-1" face="arial,helvetica"><font color="8080E6">
% if runeword.gemapplytype[1] == True:
${runeword.stats_string()}<br>${runeword.rune_stats_string(1)}
<!--${runeword.types[1]}-->
% endif
</font></font></td>

<td bgcolor="#101010" align="center"><font size="-1" face="arial,helvetica"><font color="8080E6">
% if runeword.gemapplytype[2] == True:
${runeword.stats_string()}<br>${runeword.rune_stats_string(2)}
<!--${runeword.types[2]}-->
% endif
</font></font></td>

</tr>
% endfor


</tbody></table>

